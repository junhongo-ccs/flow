$schema: https://azuremlschemas.azureedge.net/promptflow/latest/Flow.schema.json
inputs:
  user_input:
    type: object
    description: "ユーザーからの見積もり依頼"
  conversation_history:
    type: list
    default: []
  session_id:
    type: string
    default: ""
outputs:
  response:
    type: object
    reference: ${generate_response.output}
nodes:
- name: call_calc
  type: python
  source:
    type: code
    path: call_calc_tool.py
  inputs:
    user_input: ${inputs.user_input}
- name: lookup_knowledge
  type: python
  source:
    type: code
    path: lookup_knowledge.py
  inputs:
    user_input: ${inputs.user_input}
- name: generate_response
  type: llm
  source:
    type: code
    path: generate_response.jinja2
  inputs:
    calc_result: ${call_calc.output}
    user_input: ${inputs.user_input}
    knowledge: ${lookup_knowledge.output}
    conversation_history: ${inputs.conversation_history}
    deployment_name: gpt-4o
  connection: azure_openai_connection_final
  api: chat
  parameters:
    deployment_name: gpt-4o
    temperature: 0.7
    max_tokens: 1000
