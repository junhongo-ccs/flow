# デプロイ状況報告書 (2025-12-22)

## 1. 現状のサマリー
- **CI/CD (GitHub Actions)**: **成功**。コードをプッシュすると自動でテストが走り、品質を確認できる環境は整っています。
- **デプロイ (Azure Online Endpoint)**: **失敗（継続中）**。サーバーの構築（仮想サーバー/コンテナの起動）までは行っていますが、プログラムが正常に動き始める「生存確認（Liveness Probe）」の段階でタイムアウトしています。

## 2. 発生している具体的事象
Azure CLIを使用して、マネージド・オンライン・エンドポイントを構築しようとしています。これは、Prompt FlowをAPIとして公開するための仮想サーバー群です。
現在、以下の3つの壁に当たり、1と2は解決しましたが3で停滞しています。

1.  **クォータ制限 (解決済)**: 使用できるマシン種別（VM SKU）に制限がありましたが、`Standard_E2s_v3` に変更して回避しました。
2.  **ファイル数制限 (解決済)**: `venv` などの不要なファイルが多すぎてアップロードできませんでしたが、`.amlignore` を導入して解消しました。
3.  **起動タイムアウト (未解決)**: サーバー起動時にプログラムの初期化（モデル読み込み等）に時間がかかり、Azure側が「故障」と判定して停止させてしまいます。

## 3. 推奨される対処法
CLIでのデプロイが不安定なため、明日は以下の **「UI（ポータル）からの手動デプロイ」** を試すのが確実です。

### UIからの操作手順案
1.  [Azure AI Foundry ポータル](https://ai.azure.com/) にログイン
2.  プロジェクト `estimation-agent-project` を開く
3.  左メニューの「デプロイ」から「リアルタイム・エンドポイント」を作成
4.  ローカルの `estimation_agent` フォルダを指定してアップロード
5.  詳細設定で「Liveness Probe (生存確認)」の待機時間を最大に変更

## 4. 明日以降の残タスク（他リポジトリ連携）
他のリポジトリ作業（`estimate-backend-calc` やフロントエンド）を進めるために、以下のステップを想定しています。

1.  **エンドポイントの疎通確認**: サーバーが立てば、`https://.../score` というURLが発行されます。
2.  **バックエンドへのURL設定**: 上記URLを `estimate-backend-calc` の環境変数に設定し、AI見積もりを呼び出せるようにします。
3.  **モックでの開発継続**: もしデプロイが難航しても、フロント/バックの開発は「AIのフリをするモックAPI」を使って並行して進められるよう、設計を維持しています。

## 5. 結論
本日の作業で **「プログラムを安全に動かし、自動でテストする仕組み」** までは完璧に完成しました。最後の「公開用サーバーの設置」だけがAzureの機嫌（設定値）に左右されています。

明日はこのAPIができた前提で、バックエンド側でそれをどう使うか（エンジニアリングの楽しい部分）に注力しましょう。
