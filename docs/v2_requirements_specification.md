# 要件定義書 - AI見積もりシステム V2

**プロジェクト名**: AI見積もりシステム V2 - チャットベース統合相談システム  
**バージョン**: 2.0  
**作成日**: 2025-12-30  
**ステータス**: 要件定義中

## 1. プロジェクト概要

### 1.1 目的
既存のフォームベースUI（V1）を、会話型チャットUIに刷新し、Azure AI AgentとRAGを最大限活用した総合的な開発相談・見積もりシステムを構築する。

### 1.2 背景
**V1の課題:**
- フォームUIが3つの選択肢のみで、RAGの豊富な知識を活用できていない
- バックエンドAPIが画面数計算のみで、詳細な見積もりができない
- デザインフェーズ、要件定義、スケジュール提案などの総合的なヒアリングが不可能

**V2での解決:**
- チャットUIで柔軟な会話フローを実現
- RAG（27ファイル）を直接参照して詳細な見積もりとスケジュールを生成
- 要件定義〜デザイン〜開発の全フェーズを統合的にヒアリング

### 1.3 スコープ
**対象範囲:**
- フロントエンド: チャットUI実装（既存フォームの完全置き換え）
- バックエンド: Azure AI Agentの会話機能強化、RAGベース見積もり生成
- RAG: スケジュール関連の新規ナレッジ追加
- 最終アウトプット: Markdown形式のダウンロード機能

**対象外:**
- バックエンドcalc APIの拡張（将来対応）
- 新規Azureリソースの作成（既存リソースを活用）

## 2. 機能要件

### 2.1 チャットUI機能

#### 2.1.1 会話インターフェース
- **要件**: ユーザーとAIの会話をタイムライン形式で表示
- **詳細**:
  - ユーザーメッセージ: 右寄せ、ユーザーカラー
  - AIメッセージ: 左寄せ、AIカラー
  - タイムスタンプ表示
  - 自動スクロール（最新メッセージへ）

#### 2.1.2 選択肢ボタン機能
- **要件**: AIメッセージ内に選択肢ボタンを表示し、クリック可能にする
- **詳細**:
  - ボタンクリックでユーザーの選択として送信
  - ホバー/アクティブ状態の視覚フィードバック
  - 選択後はボタンを無効化（選択済み表示）

#### 2.1.3 自由記述モード
- **要件**: 選択肢が適切でない場合、自由記述で回答可能
- **詳細**:
  - 「その他」ボタンでテキスト入力フィールドを表示
  - テキスト入力 + 送信ボタン
  - 入力中の状態表示

#### 2.1.4 セッションリセット機能
- **要件**: 会話を最初からやり直せる「最初からやり直す」ボタン（Restartボタン）を提供
- **詳細**:
  - ヘッダー部分にリセットボタンを配置
  - クリック時に確認ダイアログを表示
  - 承認後、サーバー側のセッションを削除し、UIを初期状態にリセット

#### 2.1.5 ビジュアル・アイデンティティ
- **要件**: AIとユーザーのメッセージを視覚的に区別
- **詳細**:
  - AIメッセージ: 専用ロボットアイコンを表示、左寄せ
  - ユーザーメッセージ: 人物アイコンを表示、右寄せ
  - 8pxグリッドに基づく一貫したスペーシング

### 2.2 Azure AI Agent機能

#### 2.2.1 会話管理
- **要件**: 複数ターンの会話を管理し、文脈を保持
- **詳細**:
  - セッションID管理
  - 会話履歴の保存
  - 会話状態の追跡（進行中/完了）

#### 2.2.2 RAGベース見積もり生成
- **要件**: RAGナレッジ（27ファイル）を基に、中堅SIer基準の見積もりを生成
- **詳細**:
  - 27個のRAGファイルから関連情報を検索
  - 中堅SIer（社員800人規模）の相場価格（PM 1.8M-2.5M, SE 1.2M-1.6M）を参照
  - デザイン案のパターン数やデザインシステムの有無に応じた費用加算を反映

#### 2.2.3 スケジュール提案
- **要件**: 開発スケジュールを提案
- **詳細**:
  - RAGのスケジュール関連データを参照
  - プロジェクトタイプ、チームサイズ、期間に基づく提案
  - フェーズ別のタイムライン生成

#### 2.2.4 選択肢生成
- **要件**: 会話の文脈に応じて適切な選択肢を動的に生成
- **詳細**:
  - 一般的な回答パターンをボタンとして提示
  - 「その他」オプションを常に含める
  - 質問内容に応じて選択肢をカスタマイズ

### 2.3 ヒアリング機能

#### 2.3.1 要件定義フェーズ
- プロジェクト概要
- 主要機能
- ターゲットユーザー
- データ移行の有無
- 多言語対応の有無
- 外部API連携の有無

#### 2.3.2 デザインフェーズ
- ワイヤーフレーム作成状況
- デザイン会社選定状況
- Figma経験
- 画面数
- レスポンシブ対応の有無
- デザイン案の提案数要求（2案、3案など）
- 包括的デザインシステム構築の要否

#### 2.3.3 開発フェーズ
- プロジェクトタイプ（Web/モバイル/両方）
- チームサイズ
- 希望納期
- AI機能の有無
- インフラ要件
- テスト要件
- 保守・運用要件

### 2.4 最終アウトプット

#### 2.4.1 Markdown文書構成
```markdown
# プロジェクト見積もり・提案書

## 1. プロジェクト概要
## 2. 要件サマリー
## 3. 見積もり詳細
### 3.1 開発費用
### 3.2 保守・運用費用
## 4. 開発スケジュール
### フェーズ1: 要件定義・設計
### フェーズ2: 開発・実装
### フェーズ3: テスト・QA
### フェーズ4: リリース
## 5. 技術スタック
## 6. 推奨事項
## 7. 前提条件・除外事項
## 8. 次のステップ
```

## 3. 非機能要件

### 3.1 パフォーマンス
- AIレスポンス時間: 5秒以内（通常）
- チャットUIの応答性: 即座（100ms以内）
- Markdownダウンロード: 1秒以内

### 3.2 ユーザビリティ
- モバイル対応（レスポンシブデザイン）
- 直感的なチャットインターフェース
- 明確な視覚フィードバック

### 3.3 保守性
- 既存のデザインシステム（8pxグリッド）を継承
- コードの可読性とドキュメント化
- Git履歴の保持

### 3.4 セキュリティ
- CORS設定の適切な管理
- APIキーの安全な管理（環境変数）
- ユーザー入力のサニタイゼーション

## 4. 制約条件

### 4.1 技術的制約
- 既存のAzureリソースを使用（新規作成なし）
- バックエンドcalc APIは使用しない（RAGベースで代替）
- 既存のRAG 27ファイルを最大限活用

### 4.2 スケジュール制約
- V1との並行運用は不要（完全置き換え）
- 段階的リリースではなく、一括リリース

## 5. 前提条件

- Azure AI Foundryの環境が稼働中
- RAG（Azure AI Search）が構築済み
- 既存のデプロイメントパイプラインが利用可能

## 6. 除外事項

- バックエンドcalc APIの拡張・改修
- 新規Azureリソースのプロビジョニング
- V1との互換性維持
- 管理画面の構築

## 7. 成功基準

1. **機能面**: チャットUIで要件定義〜デザイン〜開発の全フェーズをヒアリング可能
2. **品質面**: RAGの27ファイルすべてを活用した詳細な見積もり生成
3. **UX面**: ユーザーが自然に会話できるインターフェース
4. **アウトプット**: クライアント合意可能なレベルのMarkdown文書生成

## 8. リスクと対策

### リスク1: RAGベース見積もりの精度
- **対策**: プロンプトエンジニアリングで計算ロジックを明確化、RAGデータの充実

### リスク2: 会話フローの複雑化
- **対策**: 段階的な質問設計、ユーザーがいつでも戻れる仕組み

### リスク3: Markdown生成の品質
- **対策**: テンプレート化、複数パターンでのテスト

## 9. 次のステップ

1. 技術スタック文書の作成
2. 基本設計書の作成
3. 実装計画の最終確認
4. 実装開始
